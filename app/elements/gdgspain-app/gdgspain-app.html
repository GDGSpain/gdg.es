<!--
@license
Copyright (c) 2016 GDG Spain
This code may only be used under the MIT style license found at LICENSE.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../../bower_components/app-layout/app-scrollpos-control/app-scrollpos-control.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">

<link rel="import" href="../../bower_components/carbon-route/carbon-location.html">
<link rel="import" href="../../bower_components/carbon-route/carbon-route.html">

<link rel="import" href="../../bower_components/font-roboto/roboto.html">

<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">

<link rel="import" href="../../bower_components/neon-animation/neon-animated-pages.html">

<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">

<link rel="import" href="../gdgspain-pages/gdgspain-page-events.html">
<link rel="import" href="../gdgspain-pages/gdgspain-page-groups.html">
<link rel="import" href="../gdgspain-pages/gdgspain-page-home.html">
<link rel="import" href="../gdgspain-pages/gdgspain-page-logo.html">
<link rel="import" href="../gdgspain-pages/gdgspain-page-404.html">

<dom-module id="gdgspain-app">
  <template>
    <style>
      :host {
        display: block;

        font-family: 'Roboto', sans-serif;

        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        -webkit-tap-highlight-color: transparent;
      }

      /* IE 10 support for HTML5 hidden attr */
      [hidden] {
        display: none !important;
      }

      .drawer-content {
        overflow-y: auto;

        height: 100%;
      }

      .drawer-menu {
        display: block;
      }

      .drawer-menu a {
        display: block;

        text-decoration: none;

        color: #333333;

        font-weight: 500;
      }

      .drawer-menu a.iron-selected {
        background-color: #d3d5d7;
      }

      .main-header {
        color: var(--primary-color);
        background-color: #FFFFFF;
      }

      .main-toolbar {
        height: 56px;
        padding: 0 8px;
      }

      .logo-container {
        @apply(--layout-horizontal);
        @apply(--layout-flex);
        @apply(--layout-center);

        height: 100%;
      }

      .logo-container a {
        display: inline-block;

        width: 164px;
        height: 34px;
      }

      .logo-container a iron-image {
        width: 100%;
        height: 100%;
      }

      .main-menu {
        --paper-tabs-selection-bar-color: var(--primary-color);

        width: 250px;
        height: 100%;
      }

      .main-menu paper-tab {
        --paper-tab-ink: var(--accent-color);

        color: var(--primary-color);
      }

      .main-menu paper-tab a {
        @apply(--layout-horizontal);
        @apply(--layout-center-center);

        text-decoration: none;
        text-transform: uppercase;

        color: inherit;
      }
    </style>

    <carbon-location route="{{_route}}" use-hash-as-path></carbon-location>
    <carbon-route route="{{_route}}" pattern="/:page" data="{{_routeData}}"></carbon-route>

    <app-scrollpos-control selected="[[_routeData.page]]"></app-scrollpos-control>

    <iron-media-query query="min-width: 600px" query-matches="{{wideLayout}}"></iron-media-query>

    <app-drawer-layout force-narrow>
      <app-drawer id="drawer" swipe-open="{{!wideLayout}}">
        <div class="drawer-content">
          <paper-toolbar class="tall">
            <span class="bottom">GDG Spain</span>
          </paper-toolbar>
          <iron-selector
              selected="{{_routeData.page}}"
              attr-for-selected="data-route"
              on-iron-activate="_drawerSelected"
              class="drawer-menu">
            <a href="#/home" data-route="home" tabindex="-1">
              <paper-item>Inicio</paper-item>
            </a>
            <a href="#/groups" data-route="groups" tabindex="-1">
              <paper-item>Grupos</paper-item>
            </a>
            <a href="#/events" data-route="events" tabindex="-1">
              <paper-item>Eventos</paper-item>
            </a>
            <a href="#/logo" data-route="logo" tabindex="-1">
              <paper-item>Logo</paper-item>
            </a>
          </iron-selector>
        </div>
      </app-drawer>

      <app-header-layout>
        <app-header condenses reveals effects="waterfall" class="main-header">
          <app-toolbar class="main-toolbar">
            <paper-icon-button icon="menu" drawer-toggle hidden$="{{wideLayout}}"></paper-icon-button>
            <div class="logo-container" hidden$="{{!wideLayout}}">
              <a href="#/home">
                <iron-image src="../../images/gdgspain-logo.png" preload sizing="cover"></iron-image>
              </a>
            </div>
            <paper-tabs
                selected="[[_routeData.page]]"
                attr-for-selected="data-route"
                hidden$="{{!wideLayout}}"
                class="main-menu">
              <paper-tab data-route="groups" link>
                <a href="#/groups" tabindex="-1">Grupos</a>
              </paper-tab>
              <paper-tab data-route="events" link>
                <a href="#/events" tabindex="-1">Eventos</a>
              </paper-tab>
              <paper-tab data-route="logo" link>
                <a href="#/logo" tabindex="-1">Logo</a>
              </paper-tab>
            </paper-tabs>
          </app-toolbar>
        </app-header>

        <neon-animated-pages
            selected="[[_routeData.page]]"
            attr-for-selected="data-route"
            fallback-selection="404">
          <gdgspain-page-home data-route="home"></gdgspain-page-home>
          <gdgspain-page-groups data-route="groups"></gdgspain-page-groups>
          <gdgspain-page-events data-route="events"></gdgspain-page-events>
          <gdgspain-page-logo data-route="logo"></gdgspain-page-logo>
          <gdgspain-page-404 data-route="404"></gdgspain-page-404>
        </neon-animated-pages>
      </app-header-layout>
    </app-drawer-layout>
  </template>
  <script>
    Polymer({
      is: 'gdgspain-app',

      properties: {
        wideLayout: {
          type: Boolean,
          value: false,
          observer: '_onLayoutChange'
        }
      },

      attached: function() {
        // TODO: Remove this async https://github.com/PolymerElements/carbon-route/issues/44
        this.async(function() {
          if (!this._route.path) {
            this.set('_route.path', '/home');
          }
        });
      },

      _drawerSelected: function() {
        if (!this.$.drawer.persistent) {
          this.$.drawer.close();
        }
      },

      _onLayoutChange: function(wide) {
        var drawer = this.$.drawer;
        if (wide && drawer.opened) {
          drawer.opened = false;
        }
      }
    });
  </script>
</dom-module>
